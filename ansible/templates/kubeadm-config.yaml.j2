# ansible/kubeadm-config.yaml.j2
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration

kubernetesVersion: "v1.30.14"
controlPlaneEndpoint: "{{ control_plane_endpoint }}"

networking:
  podSubnet: "10.244.0.0/16"

apiServer:
  certSANs:
{% for san in apiserver_sans %}
    - "{{ san }}"
{% endfor %}
  extraArgs:
    cloud-provider: external

controllerManager:
  extraArgs:
    cloud-provider: external

scheduler: {}

---
apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration

nodeRegistration:
  criSocket: "unix:///run/containerd/containerd.sock"
  name: "{{ inventory_hostname }}"
  kubeletExtraArgs:
    cloud-provider: external
    node-ip: "{{ hostvars[inventory_hostname].private_ip }}"
